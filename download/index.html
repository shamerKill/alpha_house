<!DOCTYPE html>
<html lang="en" style="height: 100%;">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no">
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Pragma" content="no-cache">
  <meta name="description" content="" />
  <meta name="Keywords" content="" />
  <meta name="screen-orientation" content="portrait">
  <meta name="full-screen" content="yes">
  <meta name="x5-orientation" content="portrait">
  <meta name="x5-fullscreen" content="true">
  <meta name="x5-page-mode" content="app">
  <meta name="theme-color" content="#000000" />
  <title>Alfa EX</title>
</head>
<body style="width: 100%; height: 100%; margin: 0; position: relative;">
  <img style="width: 100%; height: 100%;" src="./assets/down_bg.jpg" />

  <div id="wechart" style="position: absolute; bottom: 14%; left: 0; width: 100%; text-align: center; display: none;">
    <p style="font-size: 14px; color: #999;">微信浏览器不支持应用下载，请前往浏览器进行下载</p>
  </div>

  <div id="download" style="position: absolute; bottom: 14%; left: 0; width: 100%; text-align: center; display: none;">
    <a
      style="background-color: #0088ff; color: #fff; border-width: 0; height: 34px; width: 60%; font-size: 14px; border-radius: 15px; display: inline-block; line-height: 34px; text-decoration: none; position: relative;"
      download="alfa_ex.apk"
      href="https://alfaex.oss-cn-hongkong.aliyuncs.com/app.apk">
      <img src="./assets/android.png" style="height: 18px; position: absolute; top: 8px; left: 20%;" />
      安卓下载
    </a>
  </div>

  <div id="frist" style="position: absolute; bottom: 10%; left: 0; width: 100%; text-align: center; display: none;">
    <button
      onclick="bindCode()"
      style="background-color: #0088ff; color: #fff; border-width: 0; height: 34px; width: 60%; font-size: 14px; border-radius: 15px;">
      绑定当前邀请码
    </button>
    <br />
    <br />
    <a
      style="background-color: #0088ff; color: #fff; border-width: 0; height: 34px; width: 60%; font-size: 14px; border-radius: 15px; display: inline-block; line-height: 34px; text-decoration: none; position: relative;"
      download="alfa_ex.apk"
      href="https://alfaex.oss-cn-hongkong.aliyuncs.com/app.apk">
      <img src="./assets/android.png" style="height: 18px; position: absolute; top: 8px; left: 20%;" />
      安卓下载
    </a>
  </div>

  <div id="submit" style="position: absolute; bottom: 5%; left: 0; width: 100%; text-align: center; display: none;">
    <input
      id="submitInput"
      placeholder="请输入您的手机号或邮箱"
      style="width: 60%; height: 34px; padding-left: 5px; padding-right: 5px; border-radius: 5px; border-width: 1px; border-color: #0088ff;" />
    <br />
    <br />
    <button
      onclick="verfiyAccount()"
      style="background-color: #0088ff; color: #fff; border-width: 0; height: 34px; width: 60%; font-size: 14px; border-radius: 15px;">
      绑定
    </button>
    <button
      onclick="history.back()"
      style="background-color: #0088ff; color: #fff; border-width: 0; height: 34px; width: 60%; font-size: 14px; border-radius: 15px; margin-top: 10px;">
      返回
    </button>
  </div>

  <script src="./assets/axios.js"></script>
  <script>
    var loading = false;
    var downloadDOM = document.getElementById('download');
    var fristDOM = document.getElementById('frist');
    var submitDOM = document.getElementById('submit');
    var inputDOM = document.getElementById('submitInput');
    var wechartDOM = document.getElementById('wechart');
    var upCode = '';
    if (window.location.search) {
      var obj = {};
      window.location.search.replace(/[\?|\&](.*?)=([^\&]*)/g, function (_, k, v) {
        obj[k] = v;
        return '';
      });
      upCode = obj.invite_code || '';
    }
    // 如果是微信
    function isWeiXin(){
      var ua = window.navigator.userAgent.toLowerCase();
      if(ua.match(/MicroMessenger/i) == 'micromessenger'){
        return true;
      }else{
        return false;
      }
    }
    // 如果有邀请码
    if (upCode !== '') {
      downloadDOM.style.display = 'block';
      // fristDOM.style.display = 'block';
    } else {
      downloadDOM.style.display = 'block';
    }
    if (isWeiXin()) {
      downloadDOM.style.display = 'none';
      fristDOM.style.display = 'none';
      wechartDOM.style.display = 'block';
    }
    // 前往绑定邀请码
    function bindCode () {
      fristDOM.style.display = 'none';
      submitDOM.style.display = 'block';
    }
    // 验证手机号或邮箱
    function verfiyAccount () {
      if (!isPhone(inputDOM.value) && !isEmail(inputDOM.value)) {
        return alert('您输入的手机号或邮箱有误');
      }
      submit();
    }
    function isPhone (phone) {
      return /^1[3-9]\d{9}$/.test(phone);
    };
    function isEmail (email) {
      return /^([a-zA-Z]|[0-9])(\w|-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(email);
    };
    // 提交
    function submit () {
      if (loading) return;
      loading = true;
      axios.get('http://serve.alfaex.pro/user/api/v1/power/bind', {
        params: {
          InviteCode: upCode,
          Account: inputDOM.value,
        }
      }).then(function (data) {
        if (data.status !== 200) {
          return alert('网络出错，请重试');
        }
        if (data.data.status === 200) {
          alert('绑定成功');
          downloadDOM.style.display = 'block';
          fristDOM.style.display = 'none';
          submitDOM.style.display = 'none';
        } else {
          alert(data.data.message);
        }
      }).catch(function (err) {
        console.log(err);
      }).finally(function () {
        loading = false;
      });
    }
  </script>
</body>
</html>